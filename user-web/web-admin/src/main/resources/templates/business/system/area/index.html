<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml">
<head th:replace="base/base::baseHead">
</head>
<body class="childrenBody">
<div class="resourcesContent">  <!--嵌套一层-->
    <div class="btnsOperation">
        <div class="layui-inline">
            <a class="iconfont icon-tianjia layui-btn layui-btn-sm layui-btn-normal" data-type="areaAdd">添加</a>
        </div>
        <div class="layui-inline">
            <a class="iconfont icon-shuaxin layui-btn layui-btn-sm" data-type="areaFlush">刷新</a>
        </div>
    </div>
    <div class="td">
        <table id="areaTreegrid">
            <thead>
            <tr>
                <th data-options="field:'text',width:80,title:'地区名称'"></th>
                <th data-options="field:'code',width:40,title:'邮政编码'"></th>
                <th data-options="field:'areaTypeName',width:40,title:'地区类型'"></th>
                <th data-options="field:'gmtCreate',width:40,title:'创建时间'"></th>
                <th data-options="field:'description',width:60,title:'描述'"></th>
                <th data-options="field:'abc',title:'操作',align:'center',width:60,formatter:function(value,row,index){return resourceOperator(row,index)}"></th>
            </tr>
            </thead>
        </table>
    </div>
</div>
<script type="text/javascript" th:inline="javascript">
    var areaTreegrid;
    $(function () {
        //调用treegrid方法，带拖动的
        areaTreegrid = createTreegrid($('#areaTreegrid'), basePath + "/sys/area/doTreegrid");
        areaTreegrid.treegrid({
            onDblClickRow: function (row) {
                areaFunction('areaEdit',row.id);
            }
        });
        $(window).on('resize', function () {
//            带有表单查询时使用这个css.
//            $('.td').css({width:'100%',height:$(window).height()-160,border:'1px solid #F6F6F6'})
//            不带表单查询时使用下边这个css
            $('.td').css({width: '100%', height: $(window).height() - 95, border: '1px solid #F6F6F6'})
        }).resize();
    });
    layui.use(['layer'], function () {
        var layer = layui.layer;
    })
    //触发事件
    var area = {
        areaAdd: function (id) {
            var param = "";
            if (id != undefined) {
                param = "?id=" + id;
            }
            openLayer('添加下级地区', basePath + '/sys/area/toAddPage' + param);
        }, areaEdit: function (id) {
            var param = "";
            if (id != undefined) {
                param = "?id=" + id;
                openLayer('编辑地区', basePath + '/sys/area/toEditPage' + param);
            }
        }, areaRemove: function (id) {
            layer.confirm('是否确认删除?', {
                btn: ['确认', '取消'] //设置询问框上的按钮显示的文字
            }, function (index) {//点击保存执行的函数
                $.ajax({
                    url: basePath + '/sys/area/doRemove',
                    data: {ids: id},
                    dataType: "json",
                    type: "post",
                    success: function (data) {
                        reloadTree("#areaTreegrid", data);
                    }
                })
            });
        }, areaFlush: function () {
            areaTreegrid.treegrid("reload");
        }, areaSearch: function (id) {
            openLayer('地区详情', basePath + '/sys/area/toInfoPage?id=' + id);
        }
    };
    //上部按钮点击事件
    $('.layui-btn').on('click', function () {
        var type = $(this).data('type');
        area[type] ? area[type].call(this) : '';
    });

    function areaFunction(type, index) {
        area[type] ? area[type].call(this, index) : '';
        event.stopPropagation();
    }

    function resourceOperator(row, index) {
        var btn = `<button class="iconfont icon-chakan xy-button-sm xy-button xy-button-azury" onclick="areaFunction('areaSearch',${row.id})" title="详情"></button>
<button class="iconfont icon-xiugai1 xy-button xy-button-sm xy-button-blue" onclick="areaFunction('areaEdit',${row.id})" title="编辑"></button>
<button class="iconfont icon-shanchu xy-button xy-button-sm xy-button-red" onclick="areaFunction('areaRemove',${row.id})" title="删除"></button>
<button class="iconfont icon-zengjia xy-button xy-button-sm" onclick="areaFunction('areaAdd',${row.id})" title="添加下级地区"></button>`;
        return btn;
    }

</script>

</body>
</html>