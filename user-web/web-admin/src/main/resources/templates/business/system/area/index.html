<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml">
<head th:replace="base/base::baseHead">
</head>
<body class="childrenBody">
<div class="resourcesContent">  <!--嵌套一层-->
    <div class="btnsOperation">
        <div class="layui-inline">
            <a class="iconfont icon-tianjia layui-btn layui-btn-sm layui-btn-normal" data-type="areaAdd">添加</a>
        </div>
        <div class="layui-inline">
            <a class="iconfont icon-shuaxin layui-btn layui-btn-sm" data-type="areaFlush">刷新</a>
        </div>
    </div>
    <div class="td" id="areaTreegrid">
    </div>
</div>
<script type="text/javascript" th:inline="javascript">
    var area;
    $(function () {
        $(window).on('resize', function () {
            $('.td').css({width: '100%', height: $(window).height() - 75, border: '1px solid #F6F6F6'})
        }).resize();
    });
    layui.use(['tree', 'jquery', 'layer'], function () {
        var $ = layui.$ //重点处
            , layer = layui.layer;
        function areaTreegrid(data) {
            $.ajax({
                url: basePath + "/sys/area/doTreegrid",
                dataType: "json",
                data: data || {},
                type: "post",
                success: function (data) {
                    $("#areaTreegrid").html('');
                    layui.treeGird({
                        elem: '#areaTreegrid', //传入元素选择器
                        nodes: data,
                        layout: [
                            {field: 'text', name: '地区名称', treeNodes: true, style: 'width: 20%'},
                            {field: 'code', name: '邮政编码', style: 'width:15%'},
                            {field: 'areaTypeName', name: '地区类型', style: 'width:15%'},
                            {field: 'gmtCreate', name: '创建时间', style: 'width: 20%'},
                            {field: 'description', name: '描述', style: 'width: 15%'},
                            {
                                name: '操作', style: 'width: 20%', render: function (row) {
                                return resourceOperator(row);
                            }
                            },
                        ]
                    });
                }
            })
        }
        areaTreegrid();


        //触发事件
        area = {
            areaAdd: function (id) {
                var param = "";
                if (id != undefined) {
                    param = "?id=" + id;
                }
                openLayer('添加下级地区', basePath + '/sys/area/toAddPage' + param);
            }, areaEdit: function (id) {
                var param = "";
                if (id != undefined) {
                    param = "?id=" + id;
                    openLayer('编辑地区', basePath + '/sys/area/toEditPage' + param);
                }else{
                    layer.msg("请选择一条数据进行编辑！")
                }
            }, areaRemove: function (id) {
                layer.confirm('是否确认删除?', {
                    btn: ['确认', '取消'] //设置询问框上的按钮显示的文字
                }, function (index) {//点击保存执行的函数
                    $.ajax({
                        url: basePath + '/sys/area/doRemove',
                        data: {ids: id},
                        dataType: "json",
                        type: "post",
                        success: function (data) {
                            reloadTree("#areaTreegrid", data);
                        }
                    })
                });
            }, areaFlush: function () {
                areaTreegrid();
            }, areaSearch: function (id) {
                openLayer('地区详情', basePath + '/sys/area/toInfoPage?id=' + id, []);
            }
        };

    })
    //上部按钮点击事件
    $('.layui-btn').on('click', function () {
        var type = $(this).data('type');
        area[type] ? area[type].call(this) : '';
    });

    function areaFunction(type, id) {
        area[type] ? area[type].call(this, id) : '';
        event.stopPropagation();
    }

    function resourceOperator(row) {
        var btn = `<button class="iconfont icon-chakan xy-button-sm xy-button xy-button-azury" onclick="areaFunction('areaSearch',${row.id})" title="详情"></button>
<button class="iconfont icon-xiugai1 xy-button xy-button-sm xy-button-blue" onclick="areaFunction('areaEdit',${row.id})" title="编辑"></button>
<button class="iconfont icon-shanchu xy-button xy-button-sm xy-button-red" onclick="areaFunction('areaRemove',${row.id})" title="删除"></button>
<button class="iconfont icon-zengjia xy-button xy-button-sm" onclick="areaFunction('areaAdd',${row.id})" title="添加下级地区"></button>`;
        return btn;
    }
</script>

</body>
</html>